# 纯正商业级应用－Node.js Koa2开发微信小程序服务端

## 课程内容
### 第1章 前言、导学与node.js
如何理解Node.js？前端到底要不要学习Node.js？本课程能让你学到什么？（项目配套前端教程https://coding.imooc.com/class/251.html 购买即得 PSD高清设计图， 前端配套源码 ， 永久享受讲师答疑服务）

 #### 1-1 纯正商业级应用 Node.js Koa2开发微信小程序服务端-导学

 #### 1-2 异步、JavaScript特性与NodeJS
 编程的思维 NodeJS KOA 
 旧岛小样: 线上API python flask
 javascript独立开发完整小程序
 javascript语言本身的深度进阶

该课程考虑的后端语言:
 Python Flask
 Java SpringBoot
 NodeJS KOA

面向对象
 flask django 同步
 node.js 异步 KOA async await
 前端:资源 http 异步 操作数据库
 #### 1-3 申请AppKey
 AppKey: tc9gJ44p4hubcfmo

 #### 1-4 旧岛小样业务分析
 期刊

 图书 
 
 喜欢
 #### 1-5 课程维护及更新说明

### 第2章 Koa2的那点事儿与异步编程模型
Koa非常的精简，基本上，没有经过二次开发的Koa根本“不能”用。本章我们讲解Koa的重要特性，理解什么是洋葱模型？以及在KOA中如何进行异步编程？很多同学都了解以上知识点，但听完本章，你会有一些不一样的理解，比如：为什么要有洋葱模型？没有会怎样？Koa中间件一定是异步的吗？ ...

 #### 2-1 软件与环境（新手看，老鸟跳过）
 #### 2-2 node一小步，前端一大步
 #### 2-3 KOA的精简特性与二次开发必要性分析

 后端:读写数据库 写出API

 难点:
 1. 写出好的代码
 2. 提高开发效率

访问量大,研究数据库

访问量小,不用怎么研究

研究数据库难点:悲观锁 乐观锁 事务 脏读 幻读

nodejs js脱离浏览器

API低级 基础 不方便(如C)

基于nodejs 专业开发web KOA Express

##### KOA
洋葱圈模型 精简 KOA 二次开发 太难用了 比较好用 

越精简的框架,定制化能力强 喜好 习惯 二次开发 非常好用的 高级KOA

Lin CMS 


 #### 2-4 模块加载、ES、TS、Babel浅析
 #### 2-5 KOA的中间件
 #### 2-6 洋葱模型
 #### 2-7 强制Promise
 #### 2-8 深入理解async和await
 #### 2-9 为什么一定要保证洋葱模型？

### 第3章 路由系统的改造
Koa-router需要进行一些改造才好用。比如多router拆分文件，使用requireDirectory进行自动路由加载。只有做出一系列的调整，才能让KOA更加好用。

 #### 3-1 路由系统
 #### 3-2 服务端编程必备思维：主题与模型划分
 #### 3-3 多Router拆分路由
 #### 3-4 nodemon自动重启Server
 #### 3-5 vscode+nodemon调试配置
 #### 3-6 requireDirectory实现路由自动加载
 #### 3-7 初始化管理器与Process.cwd

### 第4章 异步异常与全局异常处理
很多同学都知道try catch来抛出异常，但异常是需要链式来处理的。而在异步中处理异常链条又和同步是不太一样的。此外，框架的全局异常处理又是非常的重要的，本章，我们将学习异常与全局异常的那些事儿。

 #### 4-1 参数获取与LinValidator校验器
 #### 4-2 异常理论与异常链
 #### 4-3 异步异常处理方案
 #### 4-4 全局异常处理中间件编写
 #### 4-5 已知错误与未知错误
 #### 4-6 定义异常返回格式
 #### 4-7 定义HttpException异常基类
 #### 4-8 特定异常类与global全局变量

### 第5章 LinValidator校验器与Sequelize Orm生成MySQL数据表
Koa本身是不提供校验器的，### 第三方插件也没有。那么我们只能自己来写一个Validator。本章，我们将学习LinValidator这个好用的校验器，帮助大家快速构建验证层。此外，本章节也会重点讲解Sequelize的配置、初始化等知识

 #### 5-1 Lin-Validator使用指南
 #### 5-2 Lin-Validator获取HTTP参数
 #### 5-3 配置文件与在终端显示异常
 #### 5-4 关系型数据库与非关系型数据库 （新手看，老鸟跳过）
 #### 5-5 Navicat管理MySQL （新手看，老鸟跳过）
 #### 5-6 Sequelize初始化配置与注意事项
 #### 5-7 User模型与用户唯一标识设计探讨
 #### 5-8 Sequelize个性化配置与数据维护策略
 #### 5-9 LinValidator综合应用

### 第6章 用户身份系统（通用用户系统与小程序用户系统）
任何一个系统都离不开用户这个模块。那么在KOA中如何构建用户系统？用户的权限又应该如何来分配和管理？如何标识一个用户？令牌如何使用？Sequelize如何查询和新增数据？

 #### 6-1 用户注册与Sequelize新增数据
 #### 6-2 中间件只在应用程序启动时初始化一次
 #### 6-3 盐与密码加密的小知识
 #### 6-4 模型的set操作
 #### 6-5 Success操作成功处理
 #### 6-6 isOptional校验
 #### 6-7 模拟枚举
 #### 6-8 验证用户账号密码

### 第7章 JWT令牌与Auth权限控制中间件
令牌已经是现在主流的用户身份识别的方式与机制了。本章我们讲重点讲解JWT令牌、小程序的用户身份鉴权机制。此外，如何对API进行权限控制也是本章中我们需要讨论的话题。

 #### 7-1 jsonwebtoken
 #### 7-2 HttpBasicAuth传递令牌
 #### 7-3 验证JWT令牌
 #### 7-4 API权限分级控制
可以应用至项目中

 #### 7-5 小程序openid登录系统
 #### 7-6 微信鉴权、openid与unionid
 #### 7-7 根据openid创建微信用户

### 第8章 使用Lin-UI与在小程序中使用npm
由于需要小程序的openid，所以所有接口都不能从PostMan中调试，我们需要编写一个简单的小程序测试工具，用来测试带权限的接口。本章我们将看到如何使用小程序openid构建用户系统，如何从小程序中携带JWT令牌。

 #### 8-1 Lin-UI组件库安装
 #### 8-2 在小程序中登录
 #### 8-3 Token Verify接口
 #### 8-4 数据库设计的好思路（实体表与业务表）
 #### 8-5 Music、Sentence、Movie模型定义
 #### 8-6 Flow模型与导入SQL数据
 #### 8-7 在小程序中携带令牌
 #### 8-8 Sequelize模型的序列化

### 第9章 点赞业务的实现
本章我们将实现点赞的API接口。对于点赞来说比较难的是如何保持数据的一致性，那么我们可以使用数据库的事务来确保多表插入数据时的一致性。

 #### 9-1 点赞业务逻辑分析与模型设计
 #### 9-2 数据库事务的基本概念
 #### 9-3 点赞业务逻辑实现
 #### 9-4 LinValidator的alias别名_01
 #### 9-5 使用module-alias别名简化require路径
 #### 9-6 Sequelize Scope的应用
 #### 9-7 获取上一期和下一期的期刊信息

### 第10章 面向对象与MySQL in 查询
本章我们将谈谈面向对象的实例与静态的区别，什么时候应该设计静态方法，什么时候又应该设计实例方法？此外，我们将重点讲解My SQL的in 查询。

 #### 10-1 获取期刊点赞信息
 #### 10-2 修复上小节Type的问题 
 #### 10-3 避免循环查询数据库
 #### 10-4 in查询避免循环查询数据库
 #### 10-5 面向对象设计谈：静态与实例
 #### 10-6 小心循环导入

### 第11章 MySQL group分组查询与JS并发原理
本章我们将开始Book模块的接口编写。在这些业务中，我们将重点讲解group分组查询的使用原则。同时，在本章中，我也将和大家聊聊JS的一些并发原理以扩展大家的知识视野

#### 11-1 热门书籍数据表设计
 #### 11-2 并发、并行，单线程的JS为什么可以高并发？
 #### 11-3 MySQL group分组查询
 #### 11-4 获取热门图书列表
 #### 11-5 从鱼书服务获取图书详情数据
 #### 11-6 浅谈中间层和微服务

### 第12章 KOA、Sequelize多层级JSON序列化
在KOA中如何隐藏字段、添加字段、自由序列化？本章节将讲解灵活序列化的方式

 #### 12-1 图书搜索
 #### 12-2 书籍点赞情况和我喜欢数据的数量接口实现
 #### 12-3 新增短评和短评+1接口实现
 #### 12-4 获取短评接口实现
 #### 12-5 JavaScript中的JSON序列化控制
 #### 12-6 全局控制Model模型JSON序列化行为（上）
 #### 12-7 全局控制Model模型JSON序列化行为（下）
 #### 12-8 Model上不要定义构造函数，否则会出错

### 第13章 前后端对接
我们将对接《纯正商业应用-微信小程序实战》课程中的《旧岛》小程序，并调整原有小程序代码 实现无感知刷新、获取令牌、登录等操作

 #### 13-1 小程序如何实现无感知刷新令牌？
 #### 13-2 坑！坑！坑！Model中禁止使用构造函数
 #### 13-3 短评修复
 #### 13-4 KOA静态资源
 #### 13-5 image完整路径方案探讨
 #### 13-6 静态资源存储方案探讨
 #### 13-7 access_token和refresh_token双令牌保证无感知登录

### 第14章 Lin CMS与部署指南
本章，我们将重点讲解Lin CMS的功能和开发注意事项，并帮助大家梳理应用部署的相关知识和流程

 #### 14-1 部署指南与小程序云开发探讨
 #### 14-2 守护进程与PM2
